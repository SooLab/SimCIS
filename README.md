# SimCIS

**Rethinking Query-based Transformer for Continual Image Segmentation.** *(CVPR2025)*

[![License](https://img.shields.io/badge/License-MIT-blue.svg?style=flat-square)](LICENSE)
[![Paper](https://img.shields.io/badge/Paper-arXiv-red?style=flat-square)](https://arxiv.org/abs/2507.07831)
[![HuggingFace](https://img.shields.io/badge/HuggingFace-Model-yellow?style=flat-square&logo=huggingface)](https://huggingface.co/LightningNO1/SimCIS)
![SimCLS](assets/framework.svg)

By [Yuchen Zhu*](https://zhuyuchenno1.github.io/), [Cheng Shi*](https://chengshiest.github.io/),  Dingyou Wang, Jiajin Tang, Zhengxuan Wei, Yu Wu, Guanbin Li and [Sibei Yang‚Ä†](https://sibeiyang.github.io/)

*Equal contribution; ‚Ä†Corresponding Author

## üì£ News

* [2025.06.17] ü§ó ü§ó ü§ó We Release the weights on [huggingface](https://huggingface.co/LightningNO1/SimCIS). 
* [2025.06.09] ü§ó We fully release SimCIS, including both code and [paper](https://arxiv.org/abs/2507.07831)!
* [2025.03.03] We are preparing the code and camera ready version of our paper!
* [2025.02.27] Our paper is accepted by CVPR2025!


## üìù To-do list

- [x] Release the code and paper.
- [x] Release the weights in the next few days.
- [x] More detailed instructions.


## üí° Quick Start
### 1. Set up environments

```bash
conda create --name simcis python=3.8 -y
conda activate simcis
conda install pytorch==1.9.0 torchvision==0.10.0 cudatoolkit=11.1 -c pytorch -c nvidia
pip install -U opencv-python

git clone git@github.com:SooLab/SimCIS.git
cd SimCIS

git clone git@github.com:facebookresearch/detectron2.git
cd detectron2
pip install -e .
pip install git+https://github.com/cocodataset/panopticapi.git
pip install git+https://github.com/mcordts/cityscapesScripts.git
cd ..
pip install -r requirements.txt

```

#### CUDA kernel for MSDeformAttn
After preparing the required environment, run the following command to compile CUDA kernel for MSDeformAttn:

`CUDA_HOME` must be defined and points to the directory of the installed CUDA toolkit.

```bash
cd mask2former/modeling/pixel_decoder/ops
sh make.sh
```

## 2. Data Preparation

We follow the previous work [Balconpas](https://github.com/jinpeng0528/BalConpas/tree/master) to prepare the training data. 

Please download the ADE20K dataset and its instance annotation from [here](http://sceneparsing.csail.mit.edu/), then place the dataset in or create a symbolic link to the `./datasets` directory. The structure of data path should be organized as follows:
```
ADEChallengeData2016/
  images/
  annotations/
  objectInfo150.txt
  sceneCategories.txt
  annotations_instance/
  annotations_detectron2/
  ade20k_panoptic_{train,val}.json
  ade20k_panoptic_{train,val}/
  ade20k_instance_{train,val}.json
```
The directory `annotations_detectron2` is generated by running `python datasets/prepare_ade20k_sem_seg.py`.
Then, run `python datasets/prepare_ade20k_pan_seg.py` to combine semantic and instance annotations for panoptic annotations and run `python datasets/prepare_ade20k_ins_seg.py` to extract instance annotations in COCO format.

To fit the requirements of continual segmentation tasks, run `python continual/prepare_datasets.py` to reorganize the annotations (reorganized annotations will be placed in `./json`).

#### Example data preparation
```bash
# for Mask2Former
cd datasets
wget http://data.csail.mit.edu/places/ADEchallenge/ADEChallengeData2016.zip
unzip ADEChallengeData2016.zip
cd ADEChallengeData2016
wget http://sceneparsing.csail.mit.edu/data/ChallengeData2017/annotations_instance.tar
tar -xvf annotations_instance.tar
cd ../..
python datasets/prepare_ade20k_sem_seg.py
python datasets/prepare_ade20k_pan_seg.py
python datasets/prepare_ade20k_ins_seg.py

# for continual segmentation
python continual/prepare_datasets.py
```

## üî• Training 

Download the weights of the base step(step1) from [huggingface](https://huggingface.co/LightningNO1/SimCIS). 

Please follow the [scripts](./scripts) to train SimCIS!

For example:

```bash
bash scripts/pan_100-5.sh
```

## ‚ö°Ô∏è Evaluation

Download the weights from [huggingface](https://huggingface.co/LightningNO1/SimCIS). 

Please follow the [scripts](./scripts) to evaluate SimCIS!

For example:

```bash
# 11 means the 11th step(last step for 100-5 setting)
bash scripts/panoptic_eval.sh 11
```


## üìñ Cite Us
If you find this repository useful in your research, please consider giving a star ‚≠ê and a citation
```bibtex
@inproceedings{zhu2025rethinking,
  title={Rethinking Query-based Transformer for Continual Image Segmentation},
  author={Zhu, Yuchen and Shi, Cheng and Wang, Dingyou and Tang, Jiajin and Wei, Zhengxuan and Wu, Yu and Li, Guanbin and Yang, Sibei},
  booktitle={Proceedings of the Computer Vision and Pattern Recognition Conference},
  pages={4595--4606},
  year={2025}
}
```


## üëç Acknowledgement and Related Work
* This code is mainly based on [Mask2Former](https://github.com/facebookresearch/Mask2Former). We thank them for their excellent work.
* Related work for continual image segmentation: [Balconpas](https://github.com/jinpeng0528/BalConpas/tree/master), [ECLIPSE](https://github.com/clovaai/ECLIPSE). We appreciate the contributions of these researchers.


